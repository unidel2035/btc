/**
 * ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Telegram User ID
 * Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð»ÑŽÐ±Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ñƒ Ð² Telegram
 */

import { Telegraf } from 'telegraf';
import dotenv from 'dotenv';

dotenv.config();

const botToken = process.env.TELEGRAM_BOT_TOKEN;

if (!botToken) {
  console.error('âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: TELEGRAM_BOT_TOKEN Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð² .env Ñ„Ð°Ð¹Ð»Ðµ');
  process.exit(1);
}

console.log('ðŸ¤– Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð° Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ User ID...\n');
console.log('ðŸ“± ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Telegram Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð»ÑŽÐ±Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ñƒ @bts_ai_agent_bot\n');
console.log('â•'.repeat(60));

const bot = new Telegraf(botToken);

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð´Ð»Ñ Ð»ÑŽÐ±Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
bot.on('message', async (ctx) => {
  const userId = ctx.from.id;
  const username = ctx.from.username || 'Ð±ÐµÐ· username';
  const firstName = ctx.from.first_name || '';
  const lastName = ctx.from.last_name || '';

  console.log('\nâœ… ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ:');
  console.log(`   User ID: ${userId}`);
  console.log(`   Username: @${username}`);
  console.log(`   Ð˜Ð¼Ñ: ${firstName} ${lastName}`);
  console.log('\nðŸ“‹ Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ñƒ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð² .env Ñ„Ð°Ð¹Ð»:');
  console.log(`   TELEGRAM_USER_ID=${userId}`);
  console.log('\n' + 'â•'.repeat(60));

  await ctx.reply(
    `âœ… Ð’Ð°Ñˆ User ID: ${userId}\n\n` +
    `Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ñƒ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð² .env Ñ„Ð°Ð¹Ð»:\n` +
    `TELEGRAM_USER_ID=${userId}\n\n` +
    `ÐŸÐ¾ÑÐ»Ðµ ÑÑ‚Ð¾Ð³Ð¾ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð±Ð¾Ñ‚Ð°.`
  );

  // ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼ ÑÐ»ÑƒÑˆÐ°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
});

// Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°
bot.launch();

console.log('âœ… Ð‘Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð¸ Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹...');
console.log('   ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C Ð´Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸\n');

// Graceful shutdown
process.once('SIGINT', () => {
  console.log('\n\nðŸ‘‹ ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð±Ð¾Ñ‚Ð°...');
  bot.stop('SIGINT');
});
process.once('SIGTERM', () => {
  bot.stop('SIGTERM');
});
