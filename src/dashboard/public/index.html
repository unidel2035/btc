<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BTC Trading Bot Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@3.4.15/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --secondary: #6b7280;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --dark: #1f2937;
      --dark-secondary: #374151;
      --dark-tertiary: #4b5563;
      --light: #f9fafb;
      --border: #e5e7eb;
      --text: #111827;
      --text-secondary: #6b7280;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--light);
      color: var(--text);
      line-height: 1.6;
    }

    /* Layout */
    .app-container {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 260px;
      background: var(--dark);
      color: white;
      padding: 1.5rem;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 2rem;
      font-size: 1.25rem;
      font-weight: 700;
    }

    .nav-menu {
      list-style: none;
    }

    .nav-item {
      margin-bottom: 0.5rem;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      color: #d1d5db;
      text-decoration: none;
      border-radius: 0.5rem;
      transition: all 0.2s;
      cursor: pointer;
    }

    .nav-link:hover {
      background: var(--dark-secondary);
      color: white;
    }

    .nav-link.active {
      background: var(--primary);
      color: white;
    }

    .main-content {
      flex: 1;
      margin-left: 260px;
      padding: 2rem;
      max-width: 100%;
    }

    .page-header {
      margin-bottom: 2rem;
    }

    .page-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 0.5rem;
    }

    .page-subtitle {
      color: var(--text-secondary);
    }

    /* Cards */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .card {
      background: white;
      border-radius: 0.75rem;
      padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--border);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .card-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .card-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--dark);
    }

    .card-change {
      font-size: 0.875rem;
      margin-top: 0.5rem;
    }

    .positive {
      color: var(--success);
    }

    .negative {
      color: var(--danger);
    }

    /* Tables */
    .table-container {
      background: white;
      border-radius: 0.75rem;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--border);
    }

    .table-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .table-title {
      font-size: 1.125rem;
      font-weight: 600;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      text-align: left;
      padding: 1rem 1.5rem;
      font-weight: 600;
      font-size: 0.875rem;
      color: var(--text-secondary);
      background: var(--light);
      border-bottom: 1px solid var(--border);
    }

    td {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover {
      background: var(--light);
    }

    /* Badges */
    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .badge-success {
      background: #d1fae5;
      color: #065f46;
    }

    .badge-danger {
      background: #fee2e2;
      color: #991b1b;
    }

    .badge-warning {
      background: #fef3c7;
      color: #92400e;
    }

    .badge-info {
      background: #dbeafe;
      color: #1e40af;
    }

    .badge-neutral {
      background: #f3f4f6;
      color: #374151;
    }

    /* Buttons */
    .btn {
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-sm {
      padding: 0.25rem 0.75rem;
      font-size: 0.875rem;
    }

    /* Forms */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--dark);
    }

    .form-input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      font-size: 1rem;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-checkbox {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Status indicator */
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    /* Chart container */
    .chart-container {
      position: relative;
      height: 300px;
      margin-top: 1rem;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    /* Connection status */
    .connection-status {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--border);
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .news-item {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .news-item:last-child {
      border-bottom: none;
    }

    .news-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 0.5rem;
    }

    .news-title {
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 0.5rem;
    }

    .news-meta {
      display: flex;
      gap: 1rem;
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .news-summary {
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .main-content {
        margin-left: 0;
      }

      .card-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--light);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--secondary);
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="app-container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <span>üìä</span>
          <span>BTC Trading Bot</span>
        </div>

        <ul class="nav-menu">
          <li class="nav-item">
            <a class="nav-link" :class="{ active: currentPage === 'dashboard' }" @click="currentPage = 'dashboard'">
              <span>üìà</span>
              <span>Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" :class="{ active: currentPage === 'signals' }" @click="currentPage = 'signals'">
              <span>üéØ</span>
              <span>Signals</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" :class="{ active: currentPage === 'positions' }" @click="currentPage = 'positions'">
              <span>üíº</span>
              <span>Positions</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" :class="{ active: currentPage === 'news' }" @click="currentPage = 'news'">
              <span>üì∞</span>
              <span>News Feed</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" :class="{ active: currentPage === 'analytics' }" @click="currentPage = 'analytics'">
              <span>üìä</span>
              <span>Analytics</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" :class="{ active: currentPage === 'settings' }" @click="currentPage = 'settings'">
              <span>‚öôÔ∏è</span>
              <span>Settings</span>
            </a>
          </li>
        </ul>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Dashboard Page -->
        <div v-if="currentPage === 'dashboard'">
          <div class="page-header">
            <h1 class="page-title">Dashboard</h1>
            <p class="page-subtitle">Trading bot overview and key metrics</p>
          </div>

          <div class="card-grid" v-if="overview">
            <div class="card">
              <div class="card-header">
                <span class="card-title">Total Balance</span>
              </div>
              <div class="card-value">${{ formatNumber(overview.balance.total) }}</div>
              <div class="card-change positive">+{{ formatNumber(overview.pnl.total) }} total PnL</div>
            </div>

            <div class="card">
              <div class="card-header">
                <span class="card-title">Today's PnL</span>
              </div>
              <div class="card-value" :class="overview.pnl.today >= 0 ? 'positive' : 'negative'">
                ${{ formatNumber(Math.abs(overview.pnl.today)) }}
              </div>
              <div class="card-change" :class="overview.pnl.today >= 0 ? 'positive' : 'negative'">
                {{ overview.pnl.today >= 0 ? '+' : '-' }}{{ ((overview.pnl.today / overview.balance.total) * 100).toFixed(2) }}%
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <span class="card-title">Open Positions</span>
              </div>
              <div class="card-value">{{ overview.positions.count }}</div>
              <div class="card-change">
                {{ overview.positions.long }} LONG / {{ overview.positions.short }} SHORT
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <span class="card-title">Win Rate</span>
              </div>
              <div class="card-value">{{ (overview.metrics.winRate * 100).toFixed(1) }}%</div>
              <div class="card-change">Sharpe: {{ overview.metrics.sharpeRatio.toFixed(2) }}</div>
            </div>
          </div>

          <div class="card" v-if="overview">
            <div class="card-header">
              <h3 class="card-title">Equity Curve (7 Days)</h3>
            </div>
            <div class="chart-container">
              <canvas id="equityChart"></canvas>
            </div>
          </div>

          <div class="table-container" style="margin-top: 2rem;">
            <div class="table-header">
              <h3 class="table-title">Recent Signals</h3>
            </div>
            <table v-if="overview && overview.signals.recent.length > 0">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Type</th>
                  <th>Sentiment</th>
                  <th>Impact</th>
                  <th>Source</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="signal in overview.signals.recent" :key="signal.id">
                  <td>{{ formatTime(signal.timestamp) }}</td>
                  <td><span :class="'badge badge-info'">{{ signal.type }}</span></td>
                  <td><span :class="getBadgeClass(signal.sentiment)">{{ signal.sentiment }}</span></td>
                  <td>{{ (signal.impact * 100).toFixed(0) }}%</td>
                  <td>{{ signal.source }}</td>
                </tr>
              </tbody>
            </table>
            <div v-else class="empty-state">No signals yet</div>
          </div>
        </div>

        <!-- Signals Page -->
        <div v-if="currentPage === 'signals'">
          <div class="page-header">
            <h1 class="page-title">Signals</h1>
            <p class="page-subtitle">Real-time trading signals feed</p>
          </div>

          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">All Signals ({{ signals.length }})</h3>
            </div>
            <table v-if="signals.length > 0">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Type</th>
                  <th>Sentiment</th>
                  <th>Impact</th>
                  <th>Source</th>
                  <th>ID</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="signal in signals" :key="signal.id">
                  <td>{{ formatTime(signal.timestamp) }}</td>
                  <td><span :class="'badge badge-info'">{{ signal.type }}</span></td>
                  <td><span :class="getBadgeClass(signal.sentiment)">{{ signal.sentiment }}</span></td>
                  <td>{{ (signal.impact * 100).toFixed(0) }}%</td>
                  <td>{{ signal.source }}</td>
                  <td style="font-family: monospace; font-size: 0.75rem; color: var(--text-secondary);">
                    {{ signal.id.slice(0, 8) }}
                  </td>
                </tr>
              </tbody>
            </table>
            <div v-else class="empty-state">No signals yet</div>
          </div>
        </div>

        <!-- Positions Page -->
        <div v-if="currentPage === 'positions'">
          <div class="page-header">
            <h1 class="page-title">Positions</h1>
            <p class="page-subtitle">Current and historical positions</p>
          </div>

          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">Open Positions ({{ positions.length }})</h3>
            </div>
            <table v-if="positions.length > 0">
              <thead>
                <tr>
                  <th>Symbol</th>
                  <th>Side</th>
                  <th>Size</th>
                  <th>Entry</th>
                  <th>Current</th>
                  <th>PnL</th>
                  <th>Duration</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="position in positions" :key="position.id">
                  <td><strong>{{ position.symbol }}</strong></td>
                  <td><span :class="position.side === 'long' ? 'badge badge-success' : 'badge badge-danger'">{{ position.side }}</span></td>
                  <td>${{ formatNumber(position.size) }}</td>
                  <td>${{ formatNumber(position.entryPrice) }}</td>
                  <td>${{ formatNumber(position.currentPrice) }}</td>
                  <td :class="position.pnl >= 0 ? 'positive' : 'negative'">
                    <strong>{{ position.pnl >= 0 ? '+' : '' }}${{ formatNumber(Math.abs(position.pnl)) }}</strong>
                    <br>
                    <small>({{ position.pnlPercent >= 0 ? '+' : '' }}{{ position.pnlPercent.toFixed(2) }}%)</small>
                  </td>
                  <td>{{ formatDuration(position.duration) }}</td>
                  <td>
                    <button class="btn btn-danger btn-sm" @click="closePosition(position.id)">Close</button>
                  </td>
                </tr>
              </tbody>
            </table>
            <div v-else class="empty-state">No open positions</div>
          </div>

          <div class="table-container" style="margin-top: 2rem;">
            <div class="table-header">
              <h3 class="table-title">Position History</h3>
            </div>
            <table v-if="positionHistory.length > 0">
              <thead>
                <tr>
                  <th>Symbol</th>
                  <th>Side</th>
                  <th>Entry</th>
                  <th>Exit</th>
                  <th>PnL</th>
                  <th>Closed</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="position in positionHistory.slice(0, 10)" :key="position.id">
                  <td><strong>{{ position.symbol }}</strong></td>
                  <td><span :class="position.side === 'long' ? 'badge badge-success' : 'badge badge-danger'">{{ position.side }}</span></td>
                  <td>${{ formatNumber(position.entryPrice) }}</td>
                  <td>${{ formatNumber(position.currentPrice) }}</td>
                  <td :class="position.pnl >= 0 ? 'positive' : 'negative'">
                    <strong>{{ position.pnl >= 0 ? '+' : '' }}${{ formatNumber(Math.abs(position.pnl)) }}</strong>
                  </td>
                  <td>{{ formatTime(position.exitTime) }}</td>
                </tr>
              </tbody>
            </table>
            <div v-else class="empty-state">No closed positions</div>
          </div>
        </div>

        <!-- News Feed Page -->
        <div v-if="currentPage === 'news'">
          <div class="page-header">
            <h1 class="page-title">News Feed</h1>
            <p class="page-subtitle">Latest cryptocurrency news with sentiment analysis</p>
          </div>

          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">Latest News ({{ news.length }})</h3>
            </div>
            <div v-if="news.length > 0">
              <div class="news-item" v-for="item in news" :key="item.id">
                <div class="news-header">
                  <div>
                    <h4 class="news-title">{{ item.title }}</h4>
                    <div class="news-meta">
                      <span>{{ item.source }}</span>
                      <span>‚Ä¢</span>
                      <span>{{ formatTime(item.timestamp) }}</span>
                      <span>‚Ä¢</span>
                      <span :class="getBadgeClass(item.sentiment)">{{ item.sentiment }}</span>
                      <span>‚Ä¢</span>
                      <span>Impact: {{ (item.impact * 100).toFixed(0) }}%</span>
                    </div>
                  </div>
                </div>
                <p class="news-summary">{{ item.summary }}</p>
              </div>
            </div>
            <div v-else class="empty-state">No news available</div>
          </div>
        </div>

        <!-- Analytics Page -->
        <div v-if="currentPage === 'analytics'">
          <div class="page-header">
            <h1 class="page-title">Analytics</h1>
            <p class="page-subtitle">Performance reports and statistics</p>
          </div>

          <div class="card-grid" v-if="analytics">
            <div class="card">
              <div class="card-header">
                <span class="card-title">Total Trades</span>
              </div>
              <div class="card-value">{{ analytics.trades.total }}</div>
              <div class="card-change positive">{{ analytics.trades.wins }} wins / {{ analytics.trades.losses }} losses</div>
            </div>

            <div class="card">
              <div class="card-header">
                <span class="card-title">Win Rate</span>
              </div>
              <div class="card-value">{{ (analytics.trades.winRate * 100).toFixed(1) }}%</div>
              <div class="card-change">Profit Factor: {{ analytics.profit.profitFactor.toFixed(2) }}</div>
            </div>

            <div class="card">
              <div class="card-header">
                <span class="card-title">Net Profit</span>
              </div>
              <div class="card-value positive">${{ formatNumber(analytics.profit.net) }}</div>
              <div class="card-change">Gross: ${{ formatNumber(analytics.profit.gross) }}</div>
            </div>

            <div class="card">
              <div class="card-header">
                <span class="card-title">Max Drawdown</span>
              </div>
              <div class="card-value negative">{{ analytics.risk.maxDrawdownPercent.toFixed(1) }}%</div>
              <div class="card-change">${{ formatNumber(analytics.risk.maxDrawdown) }}</div>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">Strategy Performance</h3>
            </div>
            <table v-if="strategies.length > 0">
              <thead>
                <tr>
                  <th>Strategy</th>
                  <th>Status</th>
                  <th>Signals</th>
                  <th>Trades</th>
                  <th>Win Rate</th>
                  <th>Profit</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="strategy in strategies" :key="strategy.name">
                  <td><strong>{{ strategy.name }}</strong></td>
                  <td><span :class="strategy.enabled ? 'badge badge-success' : 'badge badge-neutral'">{{ strategy.enabled ? 'Active' : 'Inactive' }}</span></td>
                  <td>{{ strategy.signals }}</td>
                  <td>{{ strategy.trades }}</td>
                  <td>{{ (strategy.winRate * 100).toFixed(1) }}%</td>
                  <td :class="strategy.profit >= 0 ? 'positive' : 'negative'">
                    ${{ formatNumber(Math.abs(strategy.profit)) }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Settings Page -->
        <div v-if="currentPage === 'settings'">
          <div class="page-header">
            <h1 class="page-title">Settings</h1>
            <p class="page-subtitle">Configure bot parameters and strategies</p>
          </div>

          <div class="card" v-if="settings">
            <h3 class="card-title" style="margin-bottom: 1.5rem;">Risk Management</h3>

            <div class="form-group">
              <label class="form-label">Max Position Size (%)</label>
              <input type="number" class="form-input" v-model="settings.risk.maxPositionSize" min="1" max="100">
            </div>

            <div class="form-group">
              <label class="form-label">Max Open Positions</label>
              <input type="number" class="form-input" v-model="settings.risk.maxPositions" min="1" max="20">
            </div>

            <div class="form-group">
              <label class="form-label">Max Daily Loss (%)</label>
              <input type="number" class="form-input" v-model="settings.risk.maxDailyLoss" min="1" max="50">
            </div>

            <div class="form-group">
              <label class="form-label">Default Stop Loss (%)</label>
              <input type="number" class="form-input" v-model="settings.risk.defaultStopLoss" min="0.1" max="20" step="0.1">
            </div>

            <div class="form-group">
              <label class="form-label">Default Take Profit (%)</label>
              <input type="number" class="form-input" v-model="settings.risk.defaultTakeProfit" min="0.1" max="50" step="0.1">
            </div>

            <button class="btn btn-primary" @click="saveSettings">Save Settings</button>
          </div>

          <div class="card" style="margin-top: 2rem;" v-if="settings">
            <h3 class="card-title" style="margin-bottom: 1.5rem;">Strategies</h3>

            <div v-for="(strategy, key) in settings.strategies" :key="key" style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border);">
              <div class="form-checkbox">
                <input type="checkbox" :id="key" v-model="strategy.enabled">
                <label :for="key" style="font-weight: 600; text-transform: capitalize;">{{ key.replace(/-/g, ' ') }}</label>
              </div>
            </div>

            <button class="btn btn-primary" @click="saveSettings">Save Settings</button>
          </div>

          <div class="card" style="margin-top: 2rem;" v-if="settings">
            <h3 class="card-title" style="margin-bottom: 1.5rem;">API Configuration</h3>

            <div class="form-group">
              <label class="form-label">Exchange</label>
              <select class="form-input" v-model="settings.api.exchange">
                <option value="binance">Binance</option>
                <option value="bybit">Bybit</option>
                <option value="okx">OKX</option>
              </select>
            </div>

            <div class="form-checkbox">
              <input type="checkbox" id="testMode" v-model="settings.api.testMode">
              <label for="testMode">Test Mode (Paper Trading)</label>
            </div>

            <button class="btn btn-primary" @click="saveSettings" style="margin-top: 1rem;">Save Settings</button>
          </div>
        </div>
      </main>
    </div>

    <!-- Connection Status -->
    <div class="connection-status" v-if="wsConnected">
      <div class="status-indicator">
        <span class="status-dot"></span>
        <span>Connected to server</span>
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          currentPage: 'dashboard',
          wsConnected: false,
          ws: null,
          overview: null,
          signals: [],
          positions: [],
          positionHistory: [],
          news: [],
          analytics: null,
          strategies: [],
          settings: null,
          equityChart: null,
        };
      },
      mounted() {
        this.connectWebSocket();
        this.loadData();
        this.startDataRefresh();
      },
      methods: {
        connectWebSocket() {
          const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
          const wsUrl = `${wsProtocol}//${window.location.host}`;

          this.ws = new WebSocket(wsUrl);

          this.ws.onopen = () => {
            console.log('WebSocket connected');
            this.wsConnected = true;
          };

          this.ws.onmessage = (event) => {
            const message = JSON.parse(event.data);
            this.handleWebSocketMessage(message);
          };

          this.ws.onclose = () => {
            console.log('WebSocket disconnected');
            this.wsConnected = false;
            // Reconnect after 5 seconds
            setTimeout(() => this.connectWebSocket(), 5000);
          };

          this.ws.onerror = (error) => {
            console.error('WebSocket error:', error);
          };
        },

        handleWebSocketMessage(message) {
          switch (message.type) {
            case 'price_update':
              // Handle real-time price updates
              break;
            case 'new_signals':
              this.signals = [...message.data, ...this.signals].slice(0, 50);
              break;
            case 'positions_update':
              this.positions = message.data;
              break;
            case 'new_news':
              this.news = [...message.data, ...this.news].slice(0, 50);
              break;
            case 'position_closed':
              this.loadPositions();
              break;
          }
        },

        async loadData() {
          await Promise.all([
            this.loadDashboard(),
            this.loadSignals(),
            this.loadPositions(),
            this.loadNews(),
            this.loadAnalytics(),
            this.loadSettings(),
          ]);
        },

        async loadDashboard() {
          try {
            const response = await fetch('/api/dashboard');
            this.overview = await response.json();
            this.$nextTick(() => {
              this.renderEquityChart();
            });
          } catch (error) {
            console.error('Failed to load dashboard:', error);
          }
        },

        async loadSignals() {
          try {
            const response = await fetch('/api/signals?limit=50');
            this.signals = await response.json();
          } catch (error) {
            console.error('Failed to load signals:', error);
          }
        },

        async loadPositions() {
          try {
            const [positionsRes, historyRes] = await Promise.all([
              fetch('/api/positions'),
              fetch('/api/positions/history?limit=20')
            ]);
            this.positions = await positionsRes.json();
            this.positionHistory = await historyRes.json();
          } catch (error) {
            console.error('Failed to load positions:', error);
          }
        },

        async loadNews() {
          try {
            const response = await fetch('/api/news?limit=50');
            this.news = await response.json();
          } catch (error) {
            console.error('Failed to load news:', error);
          }
        },

        async loadAnalytics() {
          try {
            const [performanceRes, strategiesRes] = await Promise.all([
              fetch('/api/analytics/performance?period=7d'),
              fetch('/api/analytics/strategies')
            ]);
            this.analytics = await performanceRes.json();
            this.strategies = await strategiesRes.json();
          } catch (error) {
            console.error('Failed to load analytics:', error);
          }
        },

        async loadSettings() {
          try {
            const response = await fetch('/api/settings');
            this.settings = await response.json();
          } catch (error) {
            console.error('Failed to load settings:', error);
          }
        },

        async closePosition(id) {
          if (!confirm('Are you sure you want to close this position?')) return;

          try {
            const response = await fetch(`/api/positions/${id}/close`, {
              method: 'POST'
            });
            const result = await response.json();

            if (result.success) {
              alert('Position closed successfully');
              await this.loadPositions();
              await this.loadDashboard();
            } else {
              alert(`Failed to close position: ${result.message}`);
            }
          } catch (error) {
            console.error('Failed to close position:', error);
            alert('Failed to close position');
          }
        },

        async saveSettings() {
          try {
            const response = await fetch('/api/settings', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(this.settings)
            });
            const result = await response.json();

            if (result.success) {
              alert('Settings saved successfully');
            } else {
              alert(`Failed to save settings: ${result.message}`);
            }
          } catch (error) {
            console.error('Failed to save settings:', error);
            alert('Failed to save settings');
          }
        },

        renderEquityChart() {
          if (!this.analytics || this.equityChart) return;

          const ctx = document.getElementById('equityChart');
          if (!ctx) return;

          this.equityChart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: this.analytics.equity.map(e => new Date(e.timestamp).toLocaleDateString()),
              datasets: [{
                label: 'Equity',
                data: this.analytics.equity.map(e => e.value),
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.4,
                fill: true
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                }
              },
              scales: {
                y: {
                  beginAtZero: false
                }
              }
            }
          });
        },

        startDataRefresh() {
          // Refresh data every 30 seconds
          setInterval(() => {
            if (this.currentPage === 'dashboard') {
              this.loadDashboard();
            }
          }, 30000);
        },

        formatNumber(num) {
          return num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        },

        formatTime(date) {
          const d = new Date(date);
          const now = new Date();
          const diff = Math.floor((now - d) / 1000);

          if (diff < 60) return `${diff}s ago`;
          if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
          if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
          return d.toLocaleDateString() + ' ' + d.toLocaleTimeString();
        },

        formatDuration(seconds) {
          const hours = Math.floor(seconds / 3600);
          const minutes = Math.floor((seconds % 3600) / 60);
          if (hours > 0) return `${hours}h ${minutes}m`;
          if (minutes > 0) return `${minutes}m`;
          return `${seconds}s`;
        },

        getBadgeClass(sentiment) {
          switch (sentiment) {
            case 'bullish':
              return 'badge badge-success';
            case 'bearish':
              return 'badge badge-danger';
            case 'neutral':
              return 'badge badge-neutral';
            default:
              return 'badge badge-info';
          }
        }
      }
    }).mount('#app');
  </script>
</body>
</html>
